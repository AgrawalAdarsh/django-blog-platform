<!DOCTYPE html>
<html>
<head>
    <title>Blog Platform</title>
    <style>
        body {
            font-family: Arial;
            margin: 40px;
            background: #f4f4f4;
        }
        .post {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            box-shadow: 0px 0px 5px #ccc;
        }
        .comment {
            margin-left: 20px;
            font-size: 14px;
            color: #555;
        }
        button {
            padding: 8px 12px;
            margin: 5px;
        }
    </style>
</head>
<body>

<h1>ðŸ“˜ Blog Platform</h1>

<input type="text" id="searchInput" placeholder="Search posts..." />
<button onclick="loadPosts()">Search</button>

<div id="posts"></div>

<button onclick="prevPage()">Previous</button>
<button onclick="nextPage()">Next</button>

<script>
let currentPage = 1;

function loadPosts() {
    let search = document.getElementById("searchInput").value;

    let url = `http://127.0.0.1:8000/api/posts/?page=${currentPage}&search=${search}`;

    fetch(url)
        .then(res => res.json())
        .then(data => {
            let container = document.getElementById("posts");
            container.innerHTML = "";

            data.results.forEach(post => {
                let div = document.createElement("div");
                div.className = "post";

                div.innerHTML = `
                    <h2>${post.title}</h2>
                    <p>${post.content}</p>
                    <p><b>Tags:</b> ${post.tags}</p>
                    <p><b>Status:</b> ${post.status}</p>
                    <p><b>Author:</b> ${post.author}</p>
                    <h4>Comments:</h4>
                    <div id="comments-${post.id}"></div>
                `;

                container.appendChild(div);
                loadComments(post.id);
            });
        })
        .catch(err => console.log("Fetch error:", err));
}

function loadComments(postId) {
    fetch("http://127.0.0.1:8000/api/comments/")
        .then(res => res.json())
        .then(data => {
            let commentBox = document.getElementById(`comments-${postId}`);

            data.results
                .filter(c => c.post === postId)
                .forEach(c => {
                    let p = document.createElement("p");
                    p.className = "comment";
                    p.innerText = "- " + c.text;
                    commentBox.appendChild(p);
                });
        });
}

function nextPage() {
    currentPage++;
    loadPosts();
}

function prevPage() {
    if (currentPage > 1) {
        currentPage--;
        loadPosts();
    }
}

// initial load
loadPosts();
</script>

</body>
</html>
